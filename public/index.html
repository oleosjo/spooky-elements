<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#2d1b3d" />
    <title>üéÉ Spooky Story Elements Collector</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Creepster&family=Almendra+SC&display=swap");

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html {
        height: 100%;
        /* Fix for Safari mobile viewport issues */
        height: -webkit-fill-available;
      }

      body {
        background: linear-gradient(
          135deg,
          #1a0b2e 0%,
          #2d1b3d 50%,
          #0f0519 100%
        );
        /* Ensure background covers the full height */
        min-height: 100vh;
        min-height: -webkit-fill-available;
        font-family: "Almendra SC", sans-serif;
        color: #f4a261;
        overflow-x: hidden;
        position: relative;
        /* Force hardware acceleration on mobile */
        -webkit-transform: translateZ(0);
        transform: translateZ(0);
      }

      /* Simplified background overlay for better mobile compatibility */
      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        height: -webkit-fill-available;
        background-image:
          radial-gradient(
            circle at 20% 80%,
            rgba(120, 119, 198, 0.1) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 80% 20%,
            rgba(255, 165, 0, 0.1) 0%,
            transparent 50%
          );
        pointer-events: none;
        z-index: -1;
        /* Ensure it's rendered */
        will-change: transform;
      }

      .container {
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
        min-height: 100vh;
        min-height: -webkit-fill-available;
        display: flex;
        flex-direction: column;
        justify-content: center;
        /* Add safe area padding for newer iPhones */
        padding-top: max(10px, env(safe-area-inset-top));
        padding-bottom: max(10px, env(safe-area-inset-bottom));
        padding-left: max(10px, env(safe-area-inset-left));
        padding-right: max(10px, env(safe-area-inset-right));
      }

      .card {
        background: linear-gradient(
          145deg,
          rgba(45, 27, 61, 0.95),
          rgba(26, 11, 46, 0.95)
        );
        border-radius: 20px;
        padding: 40px;
        box-shadow:
          0 20px 40px rgba(0, 0, 0, 0.5),
          inset 0 1px rgba(255, 255, 255, 0.1);
        border: 2px solid rgba(244, 162, 97, 0.3);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        position: relative;
        overflow: hidden;
        /* Ensure card has a solid background fallback */
        background-color: rgba(45, 27, 61, 0.95);
      }

      .card::before {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(
          45deg,
          transparent,
          rgba(244, 162, 97, 0.05),
          transparent
        );
        animation: shimmer 3s infinite;
        /* Improve performance on mobile */
        will-change: transform;
      }

      @keyframes shimmer {
        0% {
          transform: translateX(-100%) translateY(-100%) rotate(45deg);
        }
        100% {
          transform: translateX(100%) translateY(100%) rotate(45deg);
        }
      }

      .title {
        font-family: "Creepster", cursive;
        font-size: 3rem;
        text-align: center;
        margin-bottom: 10px;
        background: linear-gradient(45deg, #f4a261, #e76f51, #f4a261);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-shadow: 0 0 20px rgba(231, 111, 81, 0.5);
        animation: glow 2s ease-in-out infinite alternate;
        /* Fallback for browsers that don't support background-clip */
        color: #f4a261;
      }

      @keyframes glow {
        from {
          text-shadow: 0 0 20px rgba(231, 111, 81, 0.5);
        }
        to {
          text-shadow:
            0 0 30px rgba(231, 111, 81, 0.8),
            0 0 40px rgba(244, 162, 97, 0.3);
        }
      }

      .subtitle {
        text-align: center;
        margin-bottom: 30px;
        color: #e9c46a;
        font-size: 1.2rem;
        opacity: 0.9;
        font-style: italic;
      }

      .form-group {
        margin-bottom: 25px;
        position: relative;
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: normal;
        color: #f4a261;
        font-size: 1.1rem;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
      }

      input,
      select,
      textarea {
        width: 100%;
        padding: 15px;
        border: 2px solid rgba(244, 162, 97, 0.3);
        border-radius: 12px;
        background: rgba(26, 11, 46, 0.8);
        color: #f4a261;
        font-size: 1rem;
        font-family: sans-serif;
        transition: all 0.3s ease;
        /* Removed backdrop-filter for better mobile compatibility */
      }

      input:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: #e76f51;
        box-shadow: 0 0 15px rgba(231, 111, 81, 0.3);
        transform: translateY(-2px);
      }

      input::placeholder,
      textarea::placeholder {
        color: rgba(244, 162, 97, 0.6);
      }

      .btn {
        width: 100%;
        padding: 18px;
        background: linear-gradient(45deg, #e76f51, #f4a261);
        color: #1a0b2e;
        border: none;
        border-radius: 12px;
        font-size: 1.2rem;
        font-weight: normal;
        font-family: "Almendra SC", sans-serif;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 1px;
        position: relative;
        overflow: hidden;
        /* Improve touch handling on mobile */
        -webkit-tap-highlight-color: transparent;
        touch-action: manipulation;
      }

      .btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 25px rgba(231, 111, 81, 0.4);
      }

      .btn:active {
        transform: translateY(-1px);
      }

      .btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: left 0.5s;
      }

      .btn:hover::before {
        left: 100%;
      }

      .hidden {
        display: none;
      }

      .error {
        color: #e74c3c;
        font-size: 0.9rem;
        margin-top: 5px;
        text-align: center;
      }

      .success {
        color: #27ae60;
        font-size: 1.1rem;
        text-align: center;
        margin-bottom: 20px;
      }

      .floating-pumpkin {
        position: fixed;
        font-size: 2rem;
        z-index: -1;
        animation: float 6s ease-in-out infinite;
        opacity: 0.1;
        /* Improve performance */
        will-change: transform;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0px) rotate(0deg);
        }
        50% {
          transform: translateY(-20px) rotate(10deg);
        }
      }

      .spooky-text {
        font-style: italic;
        font-size: 1.1rem;
        color: #e76f51;
        text-align: center;
        margin: 20px 0;
        opacity: 0.8;
      }

      .admin-cog {
        position: absolute;
        top: 15px;
        right: 15px;
        width: 35px;
        height: 35px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 1.2rem;
        color: rgba(244, 162, 97, 0.7);
        z-index: 10;
        /* Improve touch handling */
        -webkit-tap-highlight-color: transparent;
        touch-action: manipulation;
      }

      .admin-cog.hidden {
        display: none;
      }

      @media (max-width: 768px) {
        .title {
          font-size: 2rem;
        }
        .card {
          padding: 20px;
          /* Ensure solid background on mobile */
          background: rgba(45, 27, 61, 0.98);
        }
        .admin-cog {
          top: 11px;
          right: 11px;
          width: 10px;
          height: 10px;
          font-size: 0.8rem;
        }

        /* Mobile-specific improvements */
        input,
        select,
        textarea {
          font-size: 16px; /* Prevents zoom on iOS */
          background: rgba(26, 11, 46, 0.95);
        }

        /* Reduce animations on mobile for better performance */
        .card::before {
          animation: none;
        }

        .floating-pumpkin {
          animation-duration: 8s; /* Slower animation */
        }
      }

      /* iOS specific fixes */
      @supports (-webkit-touch-callout: none) {
        body {
          /* iOS Safari specific height fix */
          min-height: -webkit-fill-available;
        }

        .container {
          min-height: -webkit-fill-available;
        }

        /* Disable backdrop-filter on older iOS versions */
        .card {
          backdrop-filter: none;
          -webkit-backdrop-filter: none;
          background: rgba(45, 27, 61, 0.98);
        }
      }
    </style>
  </head>
  <body>
    <div class="floating-pumpkin" style="top: 10%; left: 10%">üéÉ</div>
    <div
      class="floating-pumpkin"
      style="top: 20%; right: 15%; animation-delay: -2s"
    >
      üëª
    </div>
    <div
      class="floating-pumpkin"
      style="bottom: 30%; left: 20%; animation-delay: -4s"
    >
      ü¶á
    </div>
    <div
      class="floating-pumpkin"
      style="top: 60%; right: 10%; animation-delay: -1s"
    >
      üï∑Ô∏è
    </div>

    <div class="container">
      <div class="card">
        <!-- Admin Access Cog (inside the card) -->
        <div id="adminCog" class="admin-cog" title="Admin Portal">‚öôÔ∏è</div>
        <!-- Login Screen -->
        <div id="loginScreen">
          <h1 class="title">üéÉ Spooky Elements</h1>

          <!-- Final Elements Display (when locked) -->
          <div
            id="finalElementsDisplay"
            class="hidden"
            style="
              background: rgba(231, 111, 81, 0.2);
              padding: 25px;
              border-radius: 15px;
              margin: 25px 0;
              border: 2px solid rgba(231, 111, 81, 0.6);
            "
          >
            <h2
              style="
                color: #e76f51;
                text-align: center;
                margin-bottom: 20px;
                font-family: &quot;Creepster&quot;, cursive;
                font-size: 2rem;
              "
            >
              üé≠ The Final Elements üé≠
            </h2>
            <div id="finalElementsContent"></div>
            <p
              style="
                text-align: center;
                margin-top: 20px;
                font-style: italic;
                color: #e9c46a;
              "
            >
              The element collection is complete. No more entries may be
              submitted.
            </p>
          </div>

          <div id="sacredCodeMsg" class="spooky-text">
            üóùÔ∏è Only those with the sacred code may enter
          </div>

          <form id="loginForm">
            <div class="form-group">
              <label for="accessCode">Access Code:</label>
              <input
                type="text"
                id="accessCode"
                placeholder="Enter the secret code..."
                required
              />
            </div>
            <div class="form-group">
              <label for="userName">Select Your Name:</label>
              <select id="userName" required>
                <!-- Names will be populated by JavaScript -->
              </select>
            </div>
            <button type="submit" class="btn">üíÄ Enter üïØÔ∏è</button>
            <div id="loginError" class="error"></div>
          </form>
        </div>

        <!-- Element Submission Screen -->
        <div id="elementScreen" class="hidden">
          <h1 class="title">üëª Element Creation</h1>
          <!-- <p class="subtitle">Craft your tale of terror...</p> -->
          <div class="spooky-text">
            üï∏Ô∏è Three elements to weave your nightmare üï∏Ô∏è
          </div>

          <div id="welcomeMessage" class="success"></div>

          <form id="elementForm">
            <div class="form-group">
              <label for="location">üó∫Ô∏è Location:</label>
              <input type="text" id="location" placeholder="" required />
            </div>

            <div class="form-group">
              <label for="character">üë§ Character:</label>
              <input type="text" id="character" placeholder="" required />
            </div>

            <div class="form-group">
              <label for="item">üîÆ Item:</label>
              <input type="text" id="item" placeholder="" required />
            </div>

            <button type="submit" class="btn">Seal Your Elements üìú</button>
            <div id="elementError" class="error"></div>
          </form>
        </div>

        <!-- View Existing Elements Screen -->
        <div id="viewElementsScreen" class="hidden">
          <h1 class="title">üìñ Your Elements</h1>
          <p class="subtitle">Your contribution to the grimoire...</p>
          <div class="spooky-text">ü¶á You have already sealed your fate ü¶á</div>

          <div
            id="existingElementsDisplay"
            style="
              background: rgba(26, 11, 46, 0.8);
              padding: 20px;
              border-radius: 12px;
              margin: 20px 0;
              border: 1px solid rgba(244, 162, 97, 0.3);
            "
          ></div>
        </div>

        <!-- Success Screen -->
        <div id="successScreen" class="hidden">
          <h1 class="title">‚ú® Elements Sealed!</h1>
          <p class="subtitle">
            Your elements have been added to the grimoire...
          </p>
          <div class="spooky-text">
            ü¶â The spirits have accepted your offering ü¶â
          </div>

          <div
            id="submittedElements"
            style="
              background: rgba(26, 11, 46, 0.8);
              padding: 20px;
              border-radius: 12px;
              margin: 20px 0;
              border: 1px solid rgba(244, 162, 97, 0.3);
            "
          ></div>
        </div>

        <!-- Admin Screen -->
        <div id="adminScreen" class="hidden">
          <h1 class="title">üîÆ Admin Portal</h1>
          <p class="subtitle">Master of the dark arts...</p>
          <div class="spooky-text">‚ö° Control the fate of all elements ‚ö°</div>

          <div
            style="
              display: grid;
              grid-template-columns: 1fr 1fr;
              gap: 15px;
              margin: 30px 0;
            "
          >
            <button id="generateElementsBtn" class="btn">
              Generate Random Elements üé≤
            </button>
            <button id="viewAllElementsBtn" class="btn">
              View All Elements üìö
            </button>
            <button id="exportCsvBtn" class="btn">Export CSV üìä</button>
            <button
              id="resetElementsBtn"
              class="btn"
              style="background: linear-gradient(45deg, #e74c3c, #c0392b)"
            >
              Reset All üíÄ
            </button>
          </div>

          <div
            id="randomElementsResult"
            class="hidden"
            style="
              background: rgba(26, 11, 46, 0.8);
              padding: 20px;
              border-radius: 12px;
              margin: 20px 0;
              border: 2px solid rgba(231, 111, 81, 0.5);
            "
          >
            <h3 style="color: #e76f51; margin-bottom: 15px; text-align: center">
              üé≠ The Fates Have Chosen
            </h3>
            <div id="randomElementsContent"></div>
            <button
              id="generateAnotherBtn"
              class="btn"
              style="margin-top: 15px"
            >
              Generate Another üîÑ
            </button>
          </div>

          <div
            id="allElementsResult"
            class="hidden"
            style="
              background: rgba(26, 11, 46, 0.8);
              padding: 20px;
              border-radius: 12px;
              margin: 20px 0;
              border: 1px solid rgba(244, 162, 97, 0.3);
              max-height: 400px;
              overflow-y: auto;
            "
          >
            <h3 style="color: #e76f51; margin-bottom: 15px">
              üìñ All Submitted Elements
            </h3>
            <div id="allElementsContent"></div>
          </div>

          <button
            id="adminLogoutBtn"
            class="btn"
            style="
              margin-top: 20px;
              background: linear-gradient(45deg, #6c757d, #495057);
            "
          >
            Return to Mortal Realm üåô
          </button>
        </div>
      </div>
    </div>

    <script>
      // Helper function to format dates in a human-readable way
      function formatHumanDate(dateString) {
        const date = new Date(dateString);
        const now = new Date();
        const diffMs = now - date;
        const diffMins = Math.floor(diffMs / 60000);
        const diffHours = Math.floor(diffMs / 3600000);
        const diffDays = Math.floor(diffMs / 86400000);

        // If it's today
        if (diffDays === 0) {
          if (diffMins < 1) return "Just now";
          if (diffMins < 60)
            return `${diffMins} minute${diffMins === 1 ? "" : "s"} ago`;
          if (diffHours < 24)
            return `${diffHours} hour${diffHours === 1 ? "" : "s"} ago`;
        }

        // If it's recent
        if (diffDays === 1) return "Yesterday";
        if (diffDays < 7) return `${diffDays} days ago`;

        // For older dates, show a nice format
        const options = {
          weekday: "long",
          year: "numeric",
          month: "long",
          day: "numeric",
          hour: "numeric",
          minute: "2-digit",
          hour12: true,
        };

        return date.toLocaleDateString("en-US", options);
      }

      // Add debugging and ensure DOM is loaded
      document.addEventListener("DOMContentLoaded", function () {
        console.log("DOM loaded, initializing app");

        // EDITABLE: Available user names
        const AVAILABLE_NAMES = [
          "Steve",
          "Sae",
          "Ruby",
          "Daniel",
          "Hannah",
          "Jo",
          "Jamie",
          "Wil",
          "Rachy",
          "Dad",
          "Mom",
        ];

        // API base URL
        const API_BASE = "/api";

        // Current user
        let currentUser = "";

        // DOM elements
        const loginScreen = document.getElementById("loginScreen");
        const elementScreen = document.getElementById("elementScreen");
        const viewElementsScreen =
          document.getElementById("viewElementsScreen");
        const successScreen = document.getElementById("successScreen");
        const adminScreen = document.getElementById("adminScreen");
        const loginForm = document.getElementById("loginForm");
        const elementForm = document.getElementById("elementForm");
        const loginError = document.getElementById("loginError");
        const elementError = document.getElementById("elementError");
        const welcomeMessage = document.getElementById("welcomeMessage");

        // Populate name dropdown
        populateNameDropdown();

        // Check app status on load
        checkAppStatus();

        // Populate the name dropdown with available names
        function populateNameDropdown() {
          const nameSelect = document.getElementById("userName");

          // Clear existing options except the first one
          nameSelect.innerHTML =
            '<option value="">Choose your identity...</option>';

          // Add names from the array
          AVAILABLE_NAMES.forEach((name) => {
            const option = document.createElement("option");
            option.value = name;
            option.textContent = name;
            nameSelect.appendChild(option);
          });
        }

        // Check app status (locked/unlocked)
        async function checkAppStatus() {
          try {
            const response = await fetch(`${API_BASE}/status`);
            const status = await response.json();

            if (status.isLocked && status.finalElements) {
              displayFinalElementsOnMain(status.finalElements);
              // Show admin cog even when locked for reset capability
              document.getElementById("adminCog").classList.remove("hidden");
            } else {
              document
                .getElementById("finalElementsDisplay")
                .classList.add("hidden");
              document.getElementById("loginForm").classList.remove("hidden");
              document
                .getElementById("sacredCodeMsg")
                .classList.remove("hidden");
              // Show admin cog for normal operations
              document.getElementById("adminCog").classList.remove("hidden");
            }
          } catch (error) {
            console.error("Error checking app status:", error);
          }
        }

        // Display final elements on main page
        function displayFinalElementsOnMain(finalElements) {
          const displayDiv = document.getElementById("finalElementsDisplay");
          const codeMessageDiv = document.getElementById("sacredCodeMsg");
          const contentDiv = document.getElementById("finalElementsContent");
          const loginForm = document.getElementById("loginForm");

          contentDiv.innerHTML = `
                    <div style="display: grid; gap: 15px;">
                        <div style="padding: 15px; background: rgba(26, 11, 46, 0.6); border-radius: 8px; border-left: 4px solid #e76f51;">
                            <strong>üèöÔ∏è Location:</strong> ${finalElements.location.text}
                            <div style="font-size: 0.9rem; color: #e9c46a; margin-top: 5px;">Contributed by: ${finalElements.location.user}</div>
                        </div>
                        <div style="padding: 15px; background: rgba(26, 11, 46, 0.6); border-radius: 8px; border-left: 4px solid #f4a261;">
                            <strong>üë§ Character:</strong> ${finalElements.character.text}
                            <div style="font-size: 0.9rem; color: #e9c46a; margin-top: 5px;">Contributed by: ${finalElements.character.user}</div>
                        </div>
                        <div style="padding: 15px; background: rgba(26, 11, 46, 0.6); border-radius: 8px; border-left: 4px solid #e9c46a;">
                            <strong>üîÆ Item:</strong> ${finalElements.item.text}
                            <div style="font-size: 0.9rem; color: #e9c46a; margin-top: 5px;">Contributed by: ${finalElements.item.user}</div>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 15px; font-size: 0.9rem; color: #e9c46a;">
                        Tale sealed: ${formatHumanDate(finalElements.generatedAt)}
                    </div>
                `;

          displayDiv.classList.remove("hidden");
          loginForm.classList.add("hidden"); // Hide the login form when elements are locked
          codeMessageDiv.classList.add("hidden");
        }

        // Login handler
        loginForm.addEventListener("submit", async function (e) {
          e.preventDefault();
          console.log("Login form submitted");

          const accessCode = document.getElementById("accessCode").value;
          const userName = document.getElementById("userName").value;

          console.log("Access code:", accessCode);
          console.log("User name:", userName);

          if (!userName) {
            loginError.textContent =
              "‚ùå You must choose your identity to proceed...";
            return;
          }

          // Validate access code and check user via API
          try {
            const response = await fetch(`${API_BASE}/auth/login`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                accessCode: accessCode,
                userName: userName,
              }),
            });

            const data = await response.json();

            if (!response.ok) {
              if (response.status === 423) {
                // App is locked
                loginError.textContent = `‚ùå ${data.error}`;
                if (data.finalElements) {
                  displayFinalElementsOnMain(data.finalElements);
                }
                return;
              }
              loginError.textContent = `‚ùå ${data.error}`;
              return;
            }

            currentUser = userName;
            loginError.textContent = "";

            // Check if user already submitted
            if (data.alreadySubmitted && data.existingElements) {
              displayExistingElements(data.existingElements);
              showScreen("viewElements");
            } else {
              welcomeMessage.textContent = `üé≠ Welcome, ${userName}... The darkness awaits your elements.`;
              showScreen("element");
            }
          } catch (error) {
            console.error("Error during login:", error);
            loginError.textContent = "‚ùå Connection error. Try again...";
          }
        });

        // Admin cog click handler
        document
          .getElementById("adminCog")
          .addEventListener("click", async function () {
            const accessCode = prompt("üîÆ Enter admin access code:");

            if (!accessCode) return;

            try {
              const response = await fetch(`${API_BASE}/auth/admin`, {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  accessCode: accessCode,
                }),
              });

              const data = await response.json();

              if (!response.ok) {
                alert(`‚ùå ${data.error}`);
                return;
              }

              showScreen("admin");
            } catch (error) {
              console.error("Error during admin login:", error);
              alert("‚ùå Connection error. Try again...");
            }
          });

        // Element form handler
        elementForm.addEventListener("submit", async function (e) {
          e.preventDefault();

          const location = document.getElementById("location").value.trim();
          const character = document.getElementById("character").value.trim();
          const item = document.getElementById("item").value.trim();

          if (!location || !character || !item) {
            elementError.textContent =
              "‚ùå All elements are required to complete the ritual...";
            return;
          }

          // Submit to backend
          try {
            const response = await fetch(`${API_BASE}/elements`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                user: currentUser,
                location: location,
                character: character,
                item: item,
              }),
            });

            const data = await response.json();

            if (!response.ok) {
              throw new Error(data.error || "Failed to submit elements");
            }

            elementError.textContent = "";

            // Show success screen
            displaySubmittedElements(data.elements);
            showScreen("success");
          } catch (error) {
            console.error("Error submitting elements:", error);
            elementError.textContent = `‚ùå ${error.message}`;
          }
        });

        // Generate random elements
        document
          .getElementById("generateElementsBtn")
          .addEventListener("click", generateRandomElements);
        document
          .getElementById("generateAnotherBtn")
          .addEventListener("click", generateRandomElements);

        async function generateRandomElements() {
          try {
            const response = await fetch(`${API_BASE}/elements/random`);
            const data = await response.json();

            if (!response.ok) {
              throw new Error(data.error || "Failed to generate elements");
            }

            const resultDiv = document.getElementById("randomElementsResult");
            const contentDiv = document.getElementById("randomElementsContent");

            contentDiv.innerHTML = `
                        <div style="text-align: center; margin-bottom: 20px;">
                            <h4 style="color: #f4a261; margin-bottom: 15px;">‚ú® Your Random Halloween Elements ‚ú®</h4>
                        </div>
                        <div style="display: grid; gap: 15px;">
                            <div style="padding: 15px; background: rgba(231, 111, 81, 0.2); border-radius: 8px; border-left: 4px solid #e76f51;">
                                <strong>üèöÔ∏è Location:</strong> ${data.location.text}
                                <div style="font-size: 0.9rem; color: #e9c46a; margin-top: 5px;">Contributed by: ${data.location.user}</div>
                            </div>
                            <div style="padding: 15px; background: rgba(244, 162, 97, 0.2); border-radius: 8px; border-left: 4px solid #f4a261;">
                                <strong>üë§ Character:</strong> ${data.character.text}
                                <div style="font-size: 0.9rem; color: #e9c46a; margin-top: 5px;">Contributed by: ${data.character.user}</div>
                            </div>
                            <div style="padding: 15px; background: rgba(233, 196, 106, 0.2); border-radius: 8px; border-left: 4px solid #e9c46a;">
                                <strong>üîÆ Item:</strong> ${data.item.text}
                                <div style="font-size: 0.9rem; color: #e9c46a; margin-top: 5px;">Contributed by: ${data.item.user}</div>
                            </div>
                        </div>
                        <div style="text-align: center; margin-top: 20px; font-size: 0.9rem; color: #e9c46a;">
                            Generated: ${formatHumanDate(data.generatedAt)}
                        </div>
                    `;

            resultDiv.classList.remove("hidden");
            document
              .getElementById("allElementsResult")
              .classList.add("hidden");
          } catch (error) {
            console.error("Error generating random elements:", error);
            alert(`Error: ${error.message}`);
          }
        }

        // View all elements
        document
          .getElementById("viewAllElementsBtn")
          .addEventListener("click", async function () {
            try {
              const response = await fetch(`${API_BASE}/elements`);
              const elements = await response.json();

              if (!response.ok) {
                throw new Error("Failed to fetch elements");
              }

              const resultDiv = document.getElementById("allElementsResult");
              const contentDiv = document.getElementById("allElementsContent");

              if (elements.length === 0) {
                contentDiv.innerHTML =
                  '<p style="text-align: center; color: #e9c46a;">No elements have been submitted yet...</p>';
              } else {
                contentDiv.innerHTML = elements
                  .map(
                    (element) => `
                            <div style="margin-bottom: 20px; padding: 15px; background: rgba(45, 27, 61, 0.6); border-radius: 8px; border: 1px solid rgba(244, 162, 97, 0.3);">
                                <h4 style="color: #e76f51; margin-bottom: 10px;">${element.user}'s Elements</h4>
                                <p><strong>üèöÔ∏è Location:</strong> ${element.location}</p>
                                <p><strong>üë§ Character:</strong> ${element.character}</p>
                                <p><strong>üîÆ Item:</strong> ${element.item}</p>
                                <p style="font-size: 0.8rem; color: #e9c46a; margin-top: 10px;">Submitted: ${formatHumanDate(element.timestamp)}</p>
                            </div>
                        `,
                  )
                  .join("");
              }

              resultDiv.classList.remove("hidden");
              document
                .getElementById("randomElementsResult")
                .classList.add("hidden");
            } catch (error) {
              console.error("Error fetching elements:", error);
              alert(`Error: ${error.message}`);
            }
          });

        // Export CSV
        document
          .getElementById("exportCsvBtn")
          .addEventListener("click", function () {
            window.open(`${API_BASE}/elements/export/csv`, "_blank");
          });

        // Reset all elements
        document
          .getElementById("resetElementsBtn")
          .addEventListener("click", async function () {
            if (
              !confirm(
                "Are you sure you want to delete ALL elements? This action cannot be undone!",
              )
            ) {
              return;
            }

            try {
              const response = await fetch(`${API_BASE}/elements`, {
                method: "DELETE",
              });

              if (!response.ok) {
                throw new Error("Failed to reset elements");
              }

              alert(
                "All elements have been deleted and app reset successfully!",
              );

              // Hide results
              document
                .getElementById("randomElementsResult")
                .classList.add("hidden");
              document
                .getElementById("allElementsResult")
                .classList.add("hidden");

              // Check status to update main page
              checkAppStatus();
            } catch (error) {
              console.error("Error resetting elements:", error);
              alert(`Error: ${error.message}`);
            }
          });

        // Logout handlers
        document
          .getElementById("adminLogoutBtn")
          .addEventListener("click", function () {
            logout();
          });

        function showScreen(screen) {
          loginScreen.classList.add("hidden");
          elementScreen.classList.add("hidden");
          viewElementsScreen.classList.add("hidden");
          successScreen.classList.add("hidden");
          adminScreen.classList.add("hidden");

          // Hide admin cog when in admin screen
          const adminCog = document.getElementById("adminCog");
          if (screen === "admin") {
            adminCog.classList.add("hidden");
          } else {
            adminCog.classList.remove("hidden");
          }

          switch (screen) {
            case "login":
              loginScreen.classList.remove("hidden");
              break;
            case "element":
              elementScreen.classList.remove("hidden");
              break;
            case "viewElements":
              viewElementsScreen.classList.remove("hidden");
              break;
            case "success":
              successScreen.classList.remove("hidden");
              break;
            case "admin":
              adminScreen.classList.remove("hidden");
              break;
          }
        }

        function logout() {
          // Reset forms
          loginForm.reset();
          elementForm.reset();

          // Clear messages
          loginError.textContent = "";
          elementError.textContent = "";
          welcomeMessage.textContent = "";

          currentUser = "";
          showScreen("login");
        }

        function displayExistingElements(elements) {
          const elementsDisplay = document.getElementById(
            "existingElementsDisplay",
          );
          elementsDisplay.innerHTML = `
                    <h3 style="color: #e76f51; margin-bottom: 15px;">üìñ ${elements.user}'s Elements</h3>
                    <p><strong>üèöÔ∏è Location:</strong> ${elements.location}</p>
                    <p><strong>üë§ Character:</strong> ${elements.character}</p>
                    <p><strong>üîÆ Item:</strong> ${elements.item}</p>
                    <p style="font-size: 0.9rem; color: #e9c46a; margin-top: 10px;">‚è∞ Sealed: ${formatHumanDate(elements.timestamp)}</p>
                `;
        }

        function displaySubmittedElements(elements) {
          const elementsDisplay = document.getElementById("submittedElements");
          elementsDisplay.innerHTML = `
                    <h3 style="color: #e76f51; margin-bottom: 15px;">üìñ ${elements.user}'s Elements</h3>
                    <p><strong>üèöÔ∏è Location:</strong> ${elements.location}</p>
                    <p><strong>üë§ Character:</strong> ${elements.character}</p>
                    <p><strong>üîÆ Item:</strong> ${elements.item}</p>
                    <p style="font-size: 0.9rem; color: #e9c46a; margin-top: 10px;">‚è∞ Sealed: ${formatHumanDate(elements.timestamp)}</p>
                `;
        }

        // Add some spooky sound effects on interactions (optional)
        document.addEventListener("click", function (e) {
          if (e.target.classList.contains("btn")) {
            // You could add sound effects here if desired
            e.target.style.transform = "scale(0.98)";
            setTimeout(() => {
              e.target.style.transform = "";
            }, 100);
          }
        });
      }); // End of DOMContentLoaded
    </script>
  </body>
</html>
